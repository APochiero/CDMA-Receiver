library IEEE;
use ieee.std_logic_1164.all;
use IEEE.numeric_std.all;
use ieee.std_logic_unsigned.all;

entity DecisoreHardASoglia is 
	generic ( K : positive := 4 );
	port(
		clk_DHS : in std_ulogic;
		reset_DHS : in std_ulogic;
		data_DHS : in signed( K - 1 downto 0 );
		bitstream_DHS : out std_ulogic
	);
end DecisoreHardASoglia;


architecture behavior of DecisoreHardASoglia is
	constant SF : integer := 16;
	signal waitData : signed( K - 1 downto 0 ) := ( others => '0' );
	signal sum : signed( K - 1 downto 0 ) := ( others => '0' );
	begin 
		proc : process(clk_DHS)
		begin 
			if ( rising_edge(clk_DHS)) then
				if (reset_DHS = '0' ) then
					bitstream_DHS <= 'U';
				else
					if ( waitData < SF ) then
						sum <= sum + data_DHS;
						waitData <= waitData + 1;
					else 
						-- calcola il bit
						if ( sum >= 0 ) then
							bitstream_DHS <= '1';
						else
							bitstream_DHS <= '0';
						end if;
						waitData <= (others => '0' );					
					end if;
				end if;
			end if;
		end process proc;
	end behavior;
				